<!DOCTYPE html>
<html lang="en">
<head>
    <!--หน้าเมื่อloginเเล้ว-->
    <meta charset="UTF-8">
    <title>ส่งคำร้อง</title>
    <link rel="stylesheet" type="text/css" href="request.css">
    <link rel="icon" type="image/x-icon" href="picture/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300&display=swap" rel="stylesheet">
</head>
<body>

<div class="red-border"></div>
<div class="yellow-border"></div>

<div class="container">
    <div class="white-textbox">
        <a onclick="toDashBoard()"><img src="picture/logo.png" alt="logo.png" width="332" height="72"></a>
    </div>

    <div>
        <!--เอาusername ตอนlogin มาใส่ในusername-->
        <div id="username">
            <img src="picture/notification.png" id="notification" alt="Image 1">
            <img src="picture/messege.png" alt="Image 2" id="notification">
            <p id="en-name"> username <!--เเก้ให้ตรงนี้--></p>
        </div>
    </div>

    <div class="w2-textbox">
        <div class="right"><br>
            <p><img src="picture/profile.png" alt="" id="profile"></p>
        </div>
    </div>
</div>

<div class="container">



    <ul>
        <li><a onclick="toDashBoard()" id="ok">สำนักงานทะเบียนนักศึกษา</a></li>
        <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn" id="request"><b>ยื่นคำร้อง</b></a>
            <div class="dropdown-content">
                <a onclick="toRequest()">คำร้องเพิ่ม-ถอน</a>
                <a href="#">xxx</a>
                <a href="#">xxx</a>
                <a href="#">xxx</a>
            </div>
        </li>
        <li><a href="#news" onclick="toTrackStatus()">ติดตามสถานะคำร้อง</a></li>

    </ul>

    <!-- Add line break before the form tag -->



</div>
<div class="form-container">
    <form  id="userForm" onsubmit="submitForm(event);">
        <section class="userinfo">
            <label for="firstName">ชื่อ:</label>
            <input type="text" id="firstName" name="firstName" required><br>

            <label for="lastName">นามสกุล:</label>
            <input type="text" id="lastName" name="lastName" required><br>

            <label for="studentID">เลขนักศึกษา:</label>
            <input type="text" minlength="10" maxlength="10" id="studentID" name="studentID" required><br>

            <label for="class">สาขา:</label>
            <input type="text" id="class" name="class" required><br>

            <label for="year">ปี:</label>
            <input type="text" id="year" name="year" required><br>

            <label for="date">Date:</label>
            <input type="date" id="date" name="date" required><br>

            <label for="advisor">อาจารย์ที่ปรึกษา:</label>
            <input type="text" id="advisor" name="advisor" required><br>

        </section>
        <div>
            <p>หากไม่ประสงค์เพิ่ม/ถอนในรายวิชาที่สองให้ใส่ "-" ในทุกช่อง</p>
            <div class="k0">
                <label for="d" class="k1 numbersub">ลำดับ</label>
                <label for="d" class="k1 codesub" >รหัสวิชา</label>
                <label for="d" class="k1 namesub">ชื่อวิชา</label>
                <label for="d" class="k1 sectionsub">Section</label>
                <label for="d" class="k1 datesub">วัน/เวลา</label>
                <label for="d" class="k1 teachsub">ชื่อผู้สอน</label>
                <label for="d" class="k1 reasonsub">เหตุผล</label>
                <label for="d" class="k1 ptsub">เพิ่ม/ถอน</label>
            </div>

            <label for="d" class="k2">1</label>
            <input id="subjectCode1" name="subjectCode1" class="reason" required></input>
            <input id="subjectName1" name="subjectName1" class="reason" required></input>
            <input id="section1" name="section1" class="reason" required></input>
            <input id="dayTime1" name="dayTime1" class="reason" required></input>
            <input id="teacher1" name="teacher1" class="reason" required></input>
            <input id="cause1" name="cause1" class="reason"  required></input>
            <select  id="type1" name="type1" class="permission1" required>
                <option value=""></option>
                <option value="เพิ่ม">เพิ่ม</option>
                <option value="ถอน">ถอน</option>
                <option value="ไม่ประสงค์เพิ่ม/ถอน">ไม่ประสงค์เพิ่ม/ถอน</option>
            </select>
        </div>

        <label for="d" class="k2">2</label>
        <input id="subjectCode2" name="subjectCode2" class="reason" required></input>
        <input id="subjectName2" name="subjectName2" class="reason" required></input>
        <input id="section2" name="section2" class="reason" required></input>
        <input id="dayTime2" name="dayTime2" class="reason" required></input>
        <input id="teacher2" name="teacher2" class="reason" required></input>
        <input id="cause2" name="cause2" class="reason" required></input>
        <select  class="permission1" name="type2" id="type2"  required>
            <option value=""></option>
            <option value="เพิ่ม">เพิ่ม</option>
            <option value="ถอน" >ถอน</option>
            <option value="ไม่ประสงค์เพิ่ม/ถอน">ไม่ประสงค์เพิ่ม/ถอน</option>
        </select>
        <br>

        <button type="submit" id="submit">ส่งคำร้อง</button>
    </form>
</div>

<script>
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return decodeURIComponent(pair[1]);
            }
        }
        return null;
    }

    var nameFromForm1 = getQueryVariable("name");
    var username = getQueryVariable("username");

    document.getElementById("en-name").innerHTML = nameFromForm1 ;

    function toRequest(){
        window.location.href = "request.html?name=" + encodeURIComponent(nameFromForm1) + "&username=" + encodeURIComponent(username);
    }

    function toDashBoard(){
        window.location.href = "dashboard.html?name=" + encodeURIComponent(nameFromForm1)+ "&username=" + encodeURIComponent(username);
    }

    function toTrackStatus(){
        window.location.href = "trackstatus.html?name=" + encodeURIComponent(nameFromForm1)+ "&username=" + encodeURIComponent(username);
    }
</script>

<script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js">
</script>
<script type="text/javascript">
   (function(){
      emailjs.init("gVtHktWrKg4NVD0oz");
   })();
</script>

<script>
    function sendEmail(){



        if(document.getElementById("advisor").value=="teacher1"){
        var params = {
            name: "teacher1",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e7llqyx";
    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{
            alert("success");
        }

    )
    .catch((err) => {
        alert("err");
    });
    }

    if(document.getElementById("advisor").value=="teacher2"){
        var params = {
            name: "teacher2",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e4u1y09";

    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{
            alert("success");
        }

    )
    .catch((err) => console.log(err));
    }

    if(document.getElementById("teacher1").value!=document.getElementById("advisor").value&&document.getElementById("teacher1").value=="teacher1"){
        var params = {
            name: "teacher1",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e7llqyx";
    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{
            alert("success");
        }

    )
    .catch((err) => {
        alert("err");
    });

    }

    if(document.getElementById("teacher1").value!=document.getElementById("advisor").value&&document.getElementById("teacher1").value=="teacher2"){
        var params = {
            name: "teacher2",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e4u1y09";

    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{
            alert("success");
        }

    )
    .catch((err) => console.log(err));
    }

    if(document.getElementById("teacher2").value!=document.getElementById("advisor").value&&document.getElementById("teacher2").value=="teacher1"){
        var params = {
            name: "teacher1",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e7llqyx";
    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{
            alert("success");
        }

    )
    .catch((err) => {
        alert("err");
    });

    }
    if(document.getElementById("teacher2").value!=document.getElementById("advisor").value&&document.getElementById("teacher2").value=="teacher2"){
        var params = {
            name: "teacher2",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e4u1y09";

    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{
            alert("success");
        }

    )
    .catch((err) => console.log(err));

    }

}


</script>




<script>
    function submitForm(event) {  // หยุดการส่งคำร้องข้อมูลแบบปกติของฟอร์ม
    const date = document.getElementById("date").value;
    const studentFirstName =  document.getElementById("firstName").value;
    const studentLastName = document.getElementById("lastName").value;
    const studentId = document.getElementById("studentID").value;
    const studentYear = document.getElementById("year").value;
    const studentBranch = document.getElementById("class").value;
    const advisor = document.getElementById("advisor").value;
    const subjectCode1 = document.getElementById("subjectCode1").value;
    const subjectName1 = document.getElementById("subjectName1").value;
    const section1 = document.getElementById("section1").value;
    const dayTime1 = document.getElementById("dayTime1").value;
    const teacher1 = document.getElementById("teacher1").value;
    const type1 = document.getElementById("type1").value;
    const teacherApprove1 = "waiting";
    const advisorApprove1 = "waiting";
    const subjectCode2 = document.getElementById("subjectCode2").value;
    const subjectName2 = document.getElementById("subjectName2").value;
    const section2 = document.getElementById("section2").value;
    const dayTime2 = document.getElementById("dayTime2").value;
    const teacher2 = document.getElementById("teacher2").value;
    const type2 = document.getElementById("type2").value;
    const teacherApprove2 = "waiting";
    const advisorApprove2 = "waiting";
    const cause1 = document.getElementById("cause1").value;
    const cause2 = document.getElementById("cause2").value;

    const data = {
    studentID: studentId,
    studentFirstName: studentFirstName,
    studentLastName: studentLastName,
    studentYear: 2,
    studentBranch: studentBranch,
    date: date,
    advisor: advisor,
    subjectCode1: subjectCode1,
    subjectName1: subjectName1,
    section1: section1,
    dayTime1: dayTime1,
    teacher1: teacher1,
    type1: type1,
    teacherApprove1: teacherApprove1,
    advisorApprove1: advisorApprove1,
    subjectCode2: subjectCode2,
    subjectName2: subjectName2,
    section2: section2,
    dayTime2: dayTime2,
    teacher2: teacher2,
    type2: type2,
    teacherApprove2: teacherApprove2,
    advisorApprove2: advisorApprove2,
    cause1: cause1,
    cause2: cause2
    };




    const jsonData = JSON.stringify(data);

const xhr = new XMLHttpRequest();
xhr.open("POST", "/request0000", true);
xhr.setRequestHeader("Content-Type", "application/json");

xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 && xhr.status === 201) {
        console.log("ส่งข้อมูลสำเร็จ");
        console.log(data);
        // ทำสิ่งที่คุณต้องการเมื่อส่งข้อมูลสำเร็จ
    } else if (xhr.readyState === 4 && xhr.status !== 201) {
        console.error("เกิดข้อผิดพลาดในการส่งข้อมูล");
        // ทำสิ่งที่คุณต้องการเมื่อเกิดข้อผิดพลาดในการส่งข้อมูล
    }

};
event.preventDefault();
xhr.send(jsonData);


if(document.getElementById("advisor").value=="teacher1"){
        var params = {
            name: "teacher1",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e7llqyx";
    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{
            toRequest();
        }

    )
    .catch((err) => {
        alert("err");
    });
    }

    if(document.getElementById("advisor").value=="teacher2"){
        var params = {
            name: "teacher2",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e4u1y09";

    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{

            toRequest();
        }

    )
    .catch((err) => console.log(err));
    }

    if(document.getElementById("teacher1").value!=document.getElementById("advisor").value&&document.getElementById("teacher1").value=="teacher1"){
        var params = {
            name: "teacher1",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e7llqyx";
    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{

            toRequest();
        }

    )
    .catch((err) => {
        alert("err");
    });

    }

    if(document.getElementById("teacher1").value!=document.getElementById("advisor").value&&document.getElementById("teacher1").value=="teacher2"){
        var params = {
            name: "teacher2",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e4u1y09";

    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{

            toRequest();
        }

    )
    .catch((err) => console.log(err));
    }

    if(document.getElementById("teacher2").value!=document.getElementById("advisor").value&&document.getElementById("teacher2").value=="teacher1"){
        var params = {
            name: "teacher1",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e7llqyx";
    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{

            toRequest();
        }

    )
    .catch((err) => {
        alert("err");
    });

    }
    if(document.getElementById("teacher2").value!=document.getElementById("advisor").value&&document.getElementById("teacher2").value=="teacher2"){
        var params = {
            name: "teacher2",
            message: "please approve or refuse",
            studentID: document.getElementById("studentID").value,
            studentFirstName: document.getElementById("firstName").value
        };
        const serviceID = "service_hjajl88";
    const templateID = "template_e4u1y09";

    emailjs
    .send(serviceID,templateID, params)
    .then(
        (res) =>{

            toRequest();
        }

    )
    .catch((err) => console.log(err));

    }


alert('บันทึกเเล้ว');



}

</script>

</body>
</html>

    